#pragma once
#include "../Image.h"

namespace RocketData {
	const uint16_t arcs[] PROGMEM {
		  0x0003
		, 0x0003
		, 0x0003, 0x8AD9, 0xA13B
		, 0x0003, 0x6081, 0x6850, 0x73B3, 0x83E1, 0xA7DB
		, 0x0003, 0x5851, 0x6C68, 0x78B9, 0x7C13, 0x8089, 0xACB3
		, 0x0003, 0x5399, 0x5528, 0x5A51, 0x6738, 0x6E71, 0x7630, 0x7A51, 0xAEF3
		, 0x0003, 0x5088, 0x5D01, 0x5FE0, 0x6EB9, 0x7B30, 0x7D99, 0xB06B
		, 0x0003, 0x4DE8, 0x58C9, 0x6168, 0x6F71, 0x7BB0, 0x82F1, 0xB12B
		, 0x0003, 0x4C68, 0x54E9, 0x62E8, 0x6FA1, 0x7B18, 0x8549, 0xB173
		, 0x0003, 0x4A01, 0x5198, 0x5331, 0x6330, 0x6F31, 0x7A60, 0x8461, 0xB19B
		, 0x0003, 0x48C1, 0x5060, 0x55B1, 0x63C8, 0x6F39, 0x7980, 0x8369, 0x924B, 0xA001, 0xB183
		, 0x0003, 0x4779, 0x4E58, 0x5761, 0x63A0, 0x6629, 0x6E20, 0x77E1, 0x7DA0, 0x8259, 0x8FB3, 0xA391, 0xB1A3
		, 0x0003, 0x4699, 0x4CC0, 0x58C1, 0x60A0, 0x6361, 0x6CF8, 0x75E1, 0x9042, 0x94BB, 0xA479, 0xB12B
		, 0x0003, 0x45A9, 0x4B90, 0x5961, 0x5C00, 0x62E9, 0x6C18, 0x72B1, 0x909A, 0x96D3, 0xA5A1, 0xB07B
		, 0x0003, 0x44B1, 0x4AA8, 0x5829, 0x5A08, 0x61E1, 0x67D3, 0x7281, 0x9002, 0x987B, 0xA781, 0xAEBB
		, 0x0003, 0x4459, 0x4D08, 0x55B9, 0x59E8, 0x60D1, 0x62EB, 0x7281, 0x82FB, 0x8699, 0x8E12, 0x997B
		, 0x0003, 0x43B1, 0x4EA8, 0x5301, 0x59F0, 0x5EE3, 0x7321, 0x8353, 0x87F1, 0x8F2A, 0x9A2B
		, 0x0003, 0x4319, 0x4FE0, 0x50B1, 0x5948, 0x5B83, 0x73E9, 0x8493, 0x8949, 0x8FF2, 0x9AC3
		, 0x0003, 0x42D9, 0x5873, 0x7531, 0x84EB, 0x8A81, 0x90EA, 0x9B0B
		, 0x0003, 0x4291, 0x55AB, 0x7739, 0x84E3, 0x8BD9, 0x918A, 0x9B9B
		, 0x0003, 0x4219, 0x5383, 0x79C9, 0x843B, 0x8CE9, 0x9262, 0x9BD3
		, 0x0003, 0x41E9, 0x5143, 0x7DD1, 0x831B, 0x8DE1, 0x92EA, 0x9C0B
		, 0x0003, 0x41E9, 0x4EF3, 0x8F01, 0x93AA, 0x9C4B
		, 0x0003, 0x41B9, 0x4D03, 0x8FD9, 0x9423, 0x94D2, 0x9C43
		, 0x0003, 0x41A1, 0x4B03, 0x90C9, 0x94B3, 0x963A, 0x9C93
		, 0x0003, 0x4191, 0x4973, 0x9169, 0x953B, 0x978A, 0x9CAB
		, 0x0003, 0x41A1, 0x47D3, 0x9179, 0x9773, 0x98E2, 0x9CCB
		, 0x0003, 0x41B9, 0x4623, 0x9111, 0x98E3, 0x99E2, 0x9CE3
		, 0x0003, 0x41E1, 0x44A3, 0x9141, 0x99A3, 0x9B02, 0x9D23
		, 0x0003, 0x41F9, 0x4323, 0x91A1, 0x9A5B, 0x9BE2, 0x9D33
		, 0x0003, 0x9241, 0x9ABB, 0x9C92, 0x9D83
		, 0x0003, 0x92D9, 0x9AFB, 0x9D52, 0x9D7B
		, 0x0003, 0x9391, 0x9AFB
		, 0x0003, 0x94A1, 0x9AA3
		, 0x0003, 0x9621, 0x997B
		, 0x0003
	}; // 522 bytes

	const uint16_t row_ends[] PROGMEM {		
		0x0000, 0x0001, 0x0004, 0x000A, 0x0011, 0x001A, 0x0022, 0x002A, 
		0x0032, 0x003B, 0x0046, 0x0053, 0x005F, 0x006B, 0x0077, 0x0083, 
		0x008E, 0x0099, 0x00A1, 0x00A9, 0x00B1, 0x00B9, 0x00BF, 0x00C6, 
		0x00CD, 0x00D4, 0x00DB, 0x00E2, 0x00E9, 0x00F0, 0x00F5, 0x00FA, 
		0x00FD, 0x0100, 0x0103, 0x0104
	}; // 72 bytes

	const uint32_t colors[] PROGMEM {		
		0x00FFFFFF, 0x00FF0000, 0x000000FF, 0x00000000
	}; // 16 bytes
}

class Rocket : public Image {
public:
	Rocket() {
		Image::Initialise();
	}
protected:
	inline uint16_t get_arc(uint16_t i) override {
		return pgm_read_word(&RocketData::arcs[i]);
	}

	inline uint16_t get_row_end(uint8_t row_index) override {
		return pgm_read_word(&RocketData::row_ends[row_index]);
	}

protected:
	const uint16_t angle_mask = 0xFFF8;
	const uint16_t color_mask = 0x0007;

	inline uint16_t get_angle(uint16_t arc) override {
		return arc & angle_mask;
	}

    inline uint32_t get_color(uint16_t arc) override {
        uint8_t index = arc & color_mask;

        if (index == 2 && millis() >> 9 & 0b1) {
            return 0xFFFF;
        }

        return pgm_read_dword(&(RocketData::colors[index]));
    }
};
